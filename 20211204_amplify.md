schema.graphqlファイルでコメントアウトするときは#。

graphqlファイルの文法は以下。
https://spec.graphql.org/

Lambdaだけのリソースの作り直しは、schema.graphqlファイル修正（@fuctionのコメントアウト）→apmlify pushで行う。それを経由してCloudFormationでリソース変更しないとややこしいことになるリスクあり。

amplify consoleからのデプロイでも、結局amplify push/publishしてる。

amplify pushして画面を動作確認してみると、ブラウザのコンソールに以下エラーが出力された。

```
"Error: Cannot find module 'graphql/language/visitor'
Require stack:
- /var/task/node_modules/apollo-utilities/lib/bundle.cjs.js
- /var/task/node_modules/apollo-link/lib/bundle.umd.js
- /var/task/node_modules/apollo-client/bundle.umd.js
- /var/task/node_modules/aws-appsync/lib/client.js
- /var/task/node_modules/aws-appsync/lib/index.js
- /var/task/index.js
- /var/runtime/UserFunction.js
- /var/runtime/index.js"
```

Lambdaの依存関係にgraphqlが足らない模様。amplify pushで作成されるzipファイルがおかしそう。

ローカルでamplify pushすると正しくzipファイルが作られ、上記エラーは発生しない。しかし、amplify consoleでデプロイするとダメ。

ローカル／amplify consoleで、Lambdaのzipを作成する処理に差異があるっぽい。

そこで、amplify consoleの設定をみたところ「ビルドの設定」に以下の記述を発見。

```yml
version: 1
backend:
  phases:
    build:
      commands:
        - '# Execute Amplify CLI with the helper script'
         amplifyPush --simple
```

amplifyPushとは、amplify consoleで利用できる便利スクリプト。
詳しくは以下を参照。
https://github.com/aws-amplify/amplify-console/blob/main/scripts/amplifyPush.sh

このsimpleオプションがめっちゃ怪しい。
→　simpleオプションを消したけど、ダメだった。

以下のように、amplifyPushスクリプトの実行前に、Lambda関数のところでnpm installしてみる。
https://github.com/aws-amplify/amplify-cli/issues/4846#issuecomment-739526954


amplifyPush.shでは、amplify push / publishはしておらず、amplify initだけしかしてなさそう。。どゆこと・・？

amplify cliコメントの説明
https://docs.amplify.aws/cli/start/workflows/

amplify init のオプション
https://docs.amplify.aws/cli/usage/headless/


色々調べてみたけど、結局わからず。。

最後の手段として、すべてを作り直すことにした。

amplify deleteを実行したところ、クラウド上のリソース、amplify compileの設定なども消えた。
ローカルのファイルにも色々と反映されて、ちょっとびっくり。クラウド上の状態をソースで管理してるんだから（IaCなんだから）当たり前といえば当たり前か。。

で、その状態で（commit / pushせずに）、新たにCloneしなおしてamplify initをしようとすると、以下エラー。

```
Initializing your environment: productionCould not initialize 'production': The specified bucket does not exist
```

実際には存在してるのに、存在してる体でコマンド実行したもんだから、そうなって当然だな。。


