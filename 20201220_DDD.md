エンティティなどのドメインオブジェクトのなかでは、リポジトリ（DB）にはアクセスしないんだな。
リポジトリへのアクセスは、ドメインサービスやアプリケーションサービスがやるっぽい。
サービスは、リポジトリからデータを取得して、ドメインオブジェクトをメモリ上で復元し、
あくまでもドメインオブジェクトに対していろいろな操作をするわけなんだな。
そうやって操作して変更したドメインオブジェクトを、サービスはリポジトリを使って永続化する、という感じ。
ドメインエキスパートは「このモデルは何をできるか」で着目した表現を使うわけだから、
ドメインオブジェクトではそこに専念するとなると、そういうことになるようだ。
そうすることで、ドメインオブジェクトが永続層に依存しなくてよくなるので、テストしやすい。

DBモデルを中心に考えるデータ中心アプローチは古く、
DDDはドメインを中心に考えるオブジェクト指向アプローチ。
「ERでビジネスルールを表現するのだ！」は古いし、実用に耐えないってことなのかもな。アジャイル的な要素が必要なPJにおいては。



ドメインイベント
・集約はイベント発生した後で何が起こるのかを知らなくてもよい。
・ドメインサービスで手続き的に定義すれば良いと思ったが、そのドメインとは本来関係のないことなので、
　ドメインサービスにもイベント発生後の処理は書きたくないから、やっぱり必要なんだな。
・イベントを発生させるコードが、イベントを処理するコードに依存しない。前者のコードに後者のコードが登場しない。
　結果、テストしやすい。

集約
排他制御単位みたいに、ひとまとめにして扱うべきドメインオブジェクト群、というのが集約。
集約の中のオブジェクトは他の集約から参照してもよいけど、他の集約で「保持」してよいのは集約ルートのIDのみ。
集約でいう「トランザクション」とはDBのそれではなく、ドメインとして整合性を保つべき範囲を意味する。
そのトランザクションの中では、自分の集約のみを更新すべきであり、他の集約を巻き込んではいけない。
どうしても他の集約を更新すべき場合は、結果整合性でよくなるように非同期で更新する（ってことかな？）

リポジトリ
集約１つにリポジトリ１つが用意される。例えば、注文の集約には注文リポジトリが用意される。
リポジトリはデータの保管庫であり、その実体がRDBなのかNoSQLなのかといったこととは無関係。
利用する側は実体に依存せず、コードを書ける。つまり、ドメインオブジェクトから特定のデータストアに格納するための
詰め替え処理や特定のデータストアに依存するコードが不要となる。このように、「コレクションがメモリ上にあると錯覚させること」が重要。

他コンテキストとの通信
コンテキスト間の通信においては、自分のところに腐敗防止層を置いて、相手側のドメインがこちらに入り込まないようにする。
通信が発生する以上、ネットワークについていろいろなことを考慮しておくべき。
RPC、RESTでの同期連携、メッセージ基盤での非同期連携といったバリエーションがあり、最適なものを選ぶべき。

ドメインのクライアントとなるアプリケーション
・DTO方式：DTOは、ドメイン層とUI/アプリ層との結合を断絶するために必要。なので、単純にドメインの属性を全て公開してはダメ。
ドメイン層から公開して良いものは何か、を慎重に検討する必要がある。
・DPO方式：ドメインオブジェクトそのものを公開する。ダメだろうな。
・値オブジェクト方式：リポジトリが、UI層/アプリ層の求めるオブジェクトを返す。

